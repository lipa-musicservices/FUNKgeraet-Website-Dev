<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FUNKgeræt | Band-Konfigurator</title>

  <link rel="stylesheet" href="style.css" />

  <meta http-equiv="ScreenOrientation" content="autoRotate:disabled" />
  <link rel="icon" type="image/png" href="Resources/FG-Icon.png" />
</head>

<body>
  <div id="HeadBar"></div>

  <!-- HERO -->
  <section class="CfgHero" aria-label="Band-Konfigurator">
    <div class="CfgHero__inner">
      <div class="CfgHero__badge">BAND-KONFIGURATOR</div>
      <h1 class="CfgHero__title">Stell dir deine Besetzung zusammen</h1>
      <p class="CfgHero__sub">
        Klick die Instrumente an – wir berechnen daraus den
        <span class="Accent">Vibe</span> und einen Preisrahmen.
      </p>

      <div class="CfgHero__actions">
        <a class="Btn Btn--accent" href="#cfg">Jetzt konfigurieren</a>
        <a class="Btn Btn--ghost" href="contact.html">Direkt anfragen</a>
      </div>
    </div>
  </section>

  <main class="Page" id="cfg">
    <section class="Section">
      <div class="SectionHead">
        <h2 class="SectionTitle">Band-Konfigurator</h2>
        <div class="SectionHint">Links auswählen → rechts live Ergebnis</div>
      </div>

      <div class="CfgLayout">
        <!-- LEFT -->
        <div class="CfgLeft">

          <!-- Spielzeit -->
          <div class="CfgBlock">
            <div class="CfgBlock__head">
              <div class="CfgBlock__title">1) Spielzeit</div>
              <div class="CfgBlock__hint">wir planen Sets & Energie passend</div>
            </div>

            <div class="CfgPlaytime">
              <input id="playtime" class="CfgSlider" type="range" min="30" max="240" step="15" value="90" />
              <div class="CfgPlaytime__meta">
                <div class="CfgPlaytime__value"><span id="playtimeVal">90</span> min</div>
                <div class="CfgPlaytime__legend">30–240 min · 15er Schritte</div>
              </div>
            </div>
          </div>

          <!-- Instrumente -->
          <div class="CfgBlock">
            <div class="CfgBlock__head">
              <div class="CfgBlock__title">2) Besetzung</div>
              <div class="CfgBlock__hint">anklicken</div>
            </div>

            <div class="CfgGroups" aria-label="Instrumente auswählen">

              <!-- RHYTHMUSGRUPPE -->
              <div class="CfgGroup">
                <div class="CfgGroup__head">
                  <div class="CfgGroup__title">Rhythmusgruppe</div>
                  <div class="CfgGroup__hint">Groove & Fundament</div>
                </div>

                <div class="CfgGrid">
                  <button class="CfgCard" type="button" data-inst="drums" aria-pressed="false">
                    <div class="CfgCard__img"><img src="Resources/Configurator/1.png" alt="Drums" loading="lazy" /></div>
                    <div class="CfgCard__top">
                      <div class="CfgCard__name">Drums</div>
                      <div class="CfgCard__tag">Optional</div>
                    </div>
                    <div class="CfgCard__desc">Groove & Drive</div>
                  </button>

                  <button class="CfgCard" type="button" data-inst="bass" aria-pressed="false">
                    <div class="CfgCard__img"><img src="Resources/Configurator/2.png" alt="Bass" loading="lazy" /></div>
                    <div class="CfgCard__top">
                      <div class="CfgCard__name">Bass</div>
                      <div class="CfgCard__tag">Optional</div>
                    </div>
                    <div class="CfgCard__desc">Fundament & Tanz</div>
                  </button>

                  <!-- Keys FIX -->
                  <button class="CfgCard is-locked is-on" type="button" data-inst="keys" aria-pressed="true">
                    <div class="CfgCard__img"><img src="Resources/Configurator/3.png" alt="Keys" loading="lazy" /></div>
                    <div class="CfgCard__top">
                      <div class="CfgCard__name">Keys</div>
                      <div class="CfgCard__tag">Fix</div>
                    </div>
                    <div class="CfgCard__desc">Harmonie & Fläche</div>
                  </button>

                  <button class="CfgCard" type="button" data-inst="guitar" aria-pressed="false">
                    <div class="CfgCard__img"><img src="Resources/Configurator/4.png" alt="Gitarre" loading="lazy" /></div>
                    <div class="CfgCard__top">
                      <div class="CfgCard__name">Gitarre</div>
                      <div class="CfgCard__tag">Optional</div>
                    </div>
                    <div class="CfgCard__desc">Riffs & Energie</div>
                  </button>
                </div>
              </div>

              <!-- HORNS -->
              <div class="CfgGroup">
                <div class="CfgGroup__head">
                  <div class="CfgGroup__title">Horns</div>
                  <div class="CfgGroup__hint">Hooks & Punch</div>
                </div>

                <div class="CfgGrid">
                  <button class="CfgCard" type="button" data-inst="sax" aria-pressed="false">
                    <div class="CfgCard__img"><img src="Resources/Configurator/8.png" alt="Saxophon" loading="lazy" /></div>
                    <div class="CfgCard__top">
                      <div class="CfgCard__name">Sax</div>
                      <div class="CfgCard__tag">Optional</div>
                    </div>
                    <div class="CfgCard__desc">Hooks & Soli</div>
                  </button>

                  <button class="CfgCard" type="button" data-inst="trumpet" aria-pressed="false">
                    <div class="CfgCard__img"><img src="Resources/Configurator/9.png" alt="Trompete" loading="lazy" /></div>
                    <div class="CfgCard__top">
                      <div class="CfgCard__name">Trompete</div>
                      <div class="CfgCard__tag">Optional</div>
                    </div>
                    <div class="CfgCard__desc">Glanz & Punch</div>
                  </button>

                  <button class="CfgCard" type="button" data-inst="trombone" aria-pressed="false">
                    <div class="CfgCard__img"><img src="Resources/Configurator/10.png" alt="Posaune" loading="lazy" /></div>
                    <div class="CfgCard__top">
                      <div class="CfgCard__name">Posaune</div>
                      <div class="CfgCard__tag">Optional</div>
                    </div>
                    <div class="CfgCard__desc">Fett & Tief</div>
                  </button>
                </div>
              </div>

              <!-- GESANG -->
              <div class="CfgGroup">
                <div class="CfgGroup__head">
                  <div class="CfgGroup__title">Gesang</div>
                  <div class="CfgGroup__hint">Front & Mitgehen</div>
                </div>

                <div class="CfgGrid">
                  <button class="CfgCard" type="button" data-inst="vocals1" aria-pressed="false">
                    <div class="CfgCard__img"><img src="Resources/Configurator/6.png" alt="Gesang (w)" loading="lazy" /></div>
                    <div class="CfgCard__top">
                      <div class="CfgCard__name">Gesang (w)</div>
                      <div class="CfgCard__tag">Optional</div>
                    </div>
                    <div class="CfgCard__desc">Emotion & Präsenz</div>
                  </button>

                  <button class="CfgCard" type="button" data-inst="vocals2" aria-pressed="false">
                    <div class="CfgCard__img"><img src="Resources/Configurator/7.png" alt="Gesang (m)" loading="lazy" /></div>
                    <div class="CfgCard__top">
                      <div class="CfgCard__name">Gesang (m)</div>
                      <div class="CfgCard__tag">Optional</div>
                    </div>
                    <div class="CfgCard__desc">Druck & Präsenz</div>
                  </button>

                  <button class="CfgCard" type="button" data-inst="rap" aria-pressed="false">
                    <div class="CfgCard__img"><img src="Resources/Configurator/7.png" alt="Rap" loading="lazy" /></div>
                    <div class="CfgCard__top">
                      <div class="CfgCard__name">Rap</div>
                      <div class="CfgCard__tag">Optional</div>
                    </div>
                    <div class="CfgCard__desc">Peaks & Attitüde</div>
                  </button>
                </div>
              </div>

            </div>

            <div class="CfgTools">
              <button id="cfgReset" class="Btn Btn--ghost" type="button">Zurücksetzen</button>
              <div class="CfgCount" id="cfgCount">—</div>
            </div>
          </div>
        </div>

        <!-- RIGHT -->
        <aside class="CfgRight">
          <div class="CfgSticky">

            <div class="CfgResult__left">
              <div class="CfgMeter">
                <div class="CfgMeter__head">
                  <div class="CfgMeter__label">Party-Faktor</div>
                  <div class="CfgMeter__value" id="vParty">—</div>
                </div>
                <div class="CfgBar"><div class="CfgBar__fill" id="bParty"></div></div>
                <div class="CfgStars" id="sParty"></div>
              </div>

              <div class="CfgMeter">
                <div class="CfgMeter__head">
                  <div class="CfgMeter__label">Tanz-Faktor</div>
                  <div class="CfgMeter__value" id="vDance">—</div>
                </div>
                <div class="CfgBar"><div class="CfgBar__fill" id="bDance"></div></div>
                <div class="CfgStars" id="sDance"></div>
              </div>

              <div class="CfgMeter">
                <div class="CfgMeter__head">
                  <div class="CfgMeter__label">Background-Faktor</div>
                  <div class="CfgMeter__value" id="vBg">—</div>
                </div>
                <div class="CfgBar"><div class="CfgBar__fill" id="bBg"></div></div>
                <div class="CfgStars" id="sBg"></div>
              </div>

              <div class="CfgMeter">
                <div class="CfgMeter__head">
                  <div class="CfgMeter__label">Jazzclub-Faktor</div>
                  <div class="CfgMeter__value" id="vJazz">—</div>
                </div>
                <div class="CfgBar"><div class="CfgBar__fill" id="bJazz"></div></div>
                <div class="CfgStars" id="sJazz"></div>
              </div>
            </div>

            <div class="CfgSummary" style="margin-top:14px;">
              <div class="CfgPriceBox">
                <div class="CfgSummary__title">Preisrahmen</div>
                <div class="CfgPrice" id="cfgPrice">—</div>
                <div class="CfgPriceHint" id="cfgPriceHint">zzgl. Fahrtkosten · Richtwert abhängig von Datum, Ort, Technik & Sonderwünschen</div>
              </div>

              <div class="CfgLine"></div>

              <div class="CfgSummary__title">Empfehlung</div>
              <div class="CfgSummary__text" id="cfgText">Wähle Instrumente – dann bekommst du hier eine klare Empfehlung.</div>

              <div class="CfgLine"></div>

              <div class="CfgSummary__title">Deine Besetzung</div>
              <div class="CfgPills" id="cfgPills"></div>

              <div class="CfgLine"></div>

              <div class="CfgCTA">
                <a id="cfgMail" class="Btn Btn--accent" href="contact.html">Mit dieser Besetzung anfragen</a>
                <button id="cfgCopy" class="Btn Btn--ghost" type="button">Zusammenfassung kopieren</button>
              </div>

              <textarea id="cfgPayload" class="CfgPayload" readonly></textarea>
            </div>

          </div>
        </aside>
      </div>
    </section>
  </main>

  <div id="FootBar"></div>

  <!-- partials (optional) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>
    $("#HeadBar").load("FixedPages/HeadBar.html");
    $("#FootBar").load("FixedPages/FootBar.html");
  </script>

  <!-- CONFIGURATOR LOGIC -->
  <script>
  (() => {
    const INST_LABELS = {
      drums: "Drums",
      bass: "Bass",
      keys: "Keys",
      guitar: "Gitarre",
      percussion: "Percussion",
      vocals1: "Gesang (w)",
      vocals2: "Gesang (m)",
      rap: "Rap",
      sax: "Saxophon",
      trumpet: "Trompete",
      trombone: "Posaune"
    };

    const W = {
      drums:      { party: 18, dance: 22, bg: -6, jazz:  8 },
      bass:       { party: 12, dance: 18, bg:  6, jazz: 10 },
      keys:       { party: 10, dance: 10, bg: 12, jazz: 14 },
      guitar:     { party: 12, dance: 12, bg:  6, jazz:  8 },
      percussion: { party: 10, dance: 14, bg:  4, jazz:  6 },
      vocals1:    { party: 18, dance: 16, bg: -4, jazz:  2 },
      vocals2:    { party: 10, dance:  8, bg: -2, jazz:  1 },
      rap:        { party: 16, dance: 12, bg: -6, jazz:  0 },
      sax:        { party: 14, dance: 10, bg: 10, jazz: 16 },
      trumpet:    { party: 14, dance: 10, bg:  8, jazz: 14 },
      trombone:   { party: 10, dance:  8, bg:  8, jazz: 14 }
    };

    // ===== PRICE MODEL =====
    const RATE_PER_MUSICIAN_PER_HOUR = 115; // €
    const SETUP_PER_MUSICIAN = 70;          // € einmalig
    const AFTER_DEDUCTIONS_FACTOR = 0.85;   // 10% + 5% vom Gesamtwert => 85% bleiben
    const RANGE_FACTOR = 0.10;              // +/- 10%
    const ROUND_TO = 50;                    // € Rundung

    // ===== STATE =====
    const locked = new Set(["keys"]);
    const active = new Set(["keys"]);
    let playtime = 90; // minutes

    // ===== ELEMENTS =====
    const cards = document.querySelectorAll(".CfgCard");

    const playtimeEl = document.getElementById("playtime");
    const playtimeValEl = document.getElementById("playtimeVal");

    const countEl = document.getElementById("cfgCount");
    const pills = document.getElementById("cfgPills");
    const txt = document.getElementById("cfgText");
    const payload = document.getElementById("cfgPayload");

    const vParty = document.getElementById("vParty");
    const vDance = document.getElementById("vDance");
    const vBg = document.getElementById("vBg");
    const vJazz = document.getElementById("vJazz");

    const bParty = document.getElementById("bParty");
    const bDance = document.getElementById("bDance");
    const bBg = document.getElementById("bBg");
    const bJazz = document.getElementById("bJazz");

    const sParty = document.getElementById("sParty");
    const sDance = document.getElementById("sDance");
    const sBg = document.getElementById("sBg");
    const sJazz = document.getElementById("sJazz");

    const priceEl = document.getElementById("cfgPrice");
    const priceHintEl = document.getElementById("cfgPriceHint");

    const btnReset = document.getElementById("cfgReset");
    const btnCopy = document.getElementById("cfgCopy");
    const cfgMail = document.getElementById("cfgMail");

    // ===== HELPERS =====
    const clamp = (n,a,b) => Math.max(a, Math.min(b, n));
    const round = (n) => Math.round(n);

    function euro(n){
      // de-DE mit Punkt als Tausender
      return Math.round(n).toLocaleString("de-DE");
    }

    function starString(score){
      const s = clamp(score, 0, 100);
      const n = Math.round(s / 20); // 0..5
      let out = "";
      for (let i=0;i<5;i++) out += (i < n) ? "★" : "☆";
      return out;
    }

    function listActiveLabels(){
      return Array.from(active).map(k => INST_LABELS[k] || k);
    }

    function getCounts(){
      const horns  = ["sax","trumpet","trombone"].filter(h => active.has(h)).length;
      const fronts = (active.has("vocals1")?1:0) + (active.has("vocals2")?1:0) + (active.has("rap")?1:0);
      return { horns, fronts, size: active.size };
    }

    // ===== SCORING =====
    function computeScores(){
      let party=10, dance=10, bg=10, jazz=10;

      active.forEach(k => {
        const ww = W[k];
        if (!ww) return;
        party += ww.party;
        dance += ww.dance;
        bg    += ww.bg;
        jazz  += ww.jazz;
      });

      const { horns, fronts, size } = getCounts();

      // Synergien
      if (horns >= 2){ party += 10; dance += 6; }
      if (horns >= 3){ party +=  6; dance += 4; }
      if (fronts >= 1 && horns >= 1){ party += 8; }
      if (fronts === 0){ bg += 8; jazz += 6; }
      if (size >= 6){ party += 6; dance += 6; }
      if (active.has("percussion") && active.has("drums")){ dance += 4; }

      // Spielzeit bias (30..240)
      const t = clamp((playtime - 30) / (240 - 30), 0, 1); // 0 kurz, 1 lang
      party += (1 - t) * 8  - t * 2;
      dance += (1 - t) * 6  - t * 2;
      bg    += t * 10       - (1 - t) * 2;
      jazz  += t * 6;

      return {
        party: clamp(party, 0, 100),
        dance: clamp(dance, 0, 100),
        bg:    clamp(bg,    0, 100),
        jazz:  clamp(jazz,  0, 100)
      };
    }

    // ===== PRICE =====
    function computePriceRange(){
      const musicians = active.size;
      const hours = playtime / 60;

      // Das soll am Ende bei den Musikern landen (netto nach Abzügen)
      const wage =
        musicians * (hours * RATE_PER_MUSICIAN_PER_HOUR + SETUP_PER_MUSICIAN);

      // 10% + 5% Abzug vom Gesamtwert => 85% bleiben
      const base = wage / AFTER_DEDUCTIONS_FACTOR;

      const low  = base * (1 - RANGE_FACTOR);
      const high = base * (1 + RANGE_FACTOR);

      const lowR  = Math.round(low  / ROUND_TO) * ROUND_TO;
      const highR = Math.round(high / ROUND_TO) * ROUND_TO;

      return { low: lowR, high: highR, wage, base };
    }

    // ===== TEXT =====
    function makeRecommendation(scores){
      const { horns, fronts, size } = getCounts();

      const ranking = [
        {k:"party", v:scores.party, label:"Party"},
        {k:"dance", v:scores.dance, label:"Tanz"},
        {k:"bg",    v:scores.bg,    label:"Background"},
        {k:"jazz",  v:scores.jazz,  label:"Jazz/Club"}
      ].sort((a,b)=>b.v-a.v);

      const lead = ranking[0].k;

      let lines = [];
      lines.push(`Spielzeit: ${playtime} min`);
      lines.push(`Besetzung: ${size} Musiker${fronts?` · ${fronts}× Front`:``}${horns?` · ${horns}× Bläser`:``}`);
      lines.push("");

      if (lead === "dance"){
        lines.push("Vibe: Tanz – Groove vorne, Energie stabil, ohne Stress.");
      } else if (lead === "party"){
        lines.push("Vibe: Party – Hooks, Peaks, Mitsing-/Mitgeh-Momente.");
      } else if (lead === "bg"){
        lines.push("Vibe: Background – edel, kontrolliert, klingt teuer statt laut.");
      } else {
        lines.push("Vibe: Jazz/Club – musikalisch, tight, mit Farbe & Soli.");
      }

      // Tipps (kurz & hilfreich)
      if (playtime >= 150){
        lines.push("");
        lines.push("Set-Tipp: Bei langer Spielzeit lohnt sich Dramaturgie (erst smooth, später Peak).");
      } else if (playtime <= 60){
        lines.push("");
        lines.push("Set-Tipp: Kurzslot = lieber klare Highlights, kein langes Warmspielen.");
      }

      if (horns === 1 && (scores.party > 60 || scores.dance > 60)){
        lines.push("");
        lines.push("Upgrade: 2. Bläser = sofort Horn-Section-Effekt (fetter, moderner).");
      }

      if (fronts === 0 && (scores.party > 55 || scores.dance > 55)){
        lines.push("");
        lines.push("Upgrade: 1× Front (Gesang/Rap) macht’s sofort zugänglicher fürs Publikum.");
      }

      return lines.join("\n");
    }

    // ===== UI =====
    function updateUI(){
      // Cards state
      cards.forEach(card => {
        const key = card.getAttribute("data-inst");
        if (!key) return;

        const on = active.has(key);
        card.classList.toggle("is-on", on);
        card.setAttribute("aria-pressed", on ? "true" : "false");

        if (locked.has(key)) card.classList.add("is-locked");
      });

      if (countEl) countEl.textContent = `${active.size} Musiker ausgewählt`;

      const scores = computeScores();

      // Numbers
      vParty.textContent = round(scores.party);
      vDance.textContent = round(scores.dance);
      vBg.textContent    = round(scores.bg);
      vJazz.textContent  = round(scores.jazz);

      // Bars
      bParty.style.width = `${scores.party}%`;
      bDance.style.width = `${scores.dance}%`;
      bBg.style.width    = `${scores.bg}%`;
      bJazz.style.width  = `${scores.jazz}%`;

      // Stars
      sParty.textContent = starString(scores.party);
      sDance.textContent = starString(scores.dance);
      sBg.textContent    = starString(scores.bg);
      sJazz.textContent  = starString(scores.jazz);

      // Pills
      if (pills){
        pills.innerHTML = Array.from(active)
          .map(k => `<span class="CfgPill">${INST_LABELS[k] || k}</span>`)
          .join("");
      }

      // Recommendation
      if (txt) txt.textContent = makeRecommendation(scores);

      // Price
      const pr = computePriceRange();
      if (priceEl) priceEl.textContent = `${euro(pr.low)} € – ${euro(pr.high)} €`;
      if (priceHintEl) priceHintEl.textContent =
        `Richtwert: 115 €/h pro Musiker + 70 € Aufbau/Person · enthält 10% + 5% Abzug vom Gesamtwert · zzgl. Fahrtkosten.`;

      // Payload
      const payloadText =
`FUNKgeræt Band-Konfigurator
Spielzeit: ${playtime} min
Besetzung: ${listActiveLabels().join(", ")}

Scores:
Party: ${round(scores.party)}
Tanz: ${round(scores.dance)}
Background: ${round(scores.bg)}
Jazzclub: ${round(scores.jazz)}

Preisrahmen (Richtwert, zzgl. Fahrtkosten):
${euro(pr.low)} € – ${euro(pr.high)} €
`;

      if (payload) payload.value = payloadText;

      // CTA link with query param
      if (cfgMail){
        const enc = encodeURIComponent(payloadText);
        cfgMail.setAttribute("href", `contact.html?config=${enc}`);
      }
    }

    // ===== EVENTS =====

    // Card toggles
    cards.forEach(card => {
      const key = card.getAttribute("data-inst");
      if (!key) return;

      // locked defaults always on
      if (locked.has(key)){
        active.add(key);
        card.classList.add("is-on", "is-locked");
        card.setAttribute("aria-pressed", "true");
      }

      card.addEventListener("click", () => {
        if (locked.has(key)) return;

        if (active.has(key)) active.delete(key);
        else active.add(key);

        updateUI();
      });
    });

    // Reset
    if (btnReset){
      btnReset.addEventListener("click", () => {
        active.clear();
        locked.forEach(k => active.add(k));
        updateUI();
      });
    }

    // Copy
    if (btnCopy){
      btnCopy.addEventListener("click", async () => {
        const old = btnCopy.textContent;
        try{
          await navigator.clipboard.writeText(payload ? payload.value : "");
          btnCopy.textContent = "Kopiert!";
        }catch(e){
          if (payload){
            payload.focus();
            payload.select();
            document.execCommand("copy");
            btnCopy.textContent = "Kopiert!";
          }
        }
        setTimeout(()=>btnCopy.textContent = old, 1200);
      });
    }

    // Slider
    function setPlaytime(val){
      playtime = Number(val) || 90;
      if (playtimeValEl) playtimeValEl.textContent = playtime;
      updateUI();
    }

    if (playtimeEl){
      setPlaytime(playtimeEl.value);
      playtimeEl.addEventListener("input", (e) => setPlaytime(e.target.value));
    }

    // init
    updateUI();
  })();
  </script>
</body>
</html>
